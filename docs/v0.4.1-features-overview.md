# HNC v0.4.1 Features Overview

## Release Summary

HNC v0.4.1 "Expert Overrides & Enhanced CI" introduces powerful new capabilities for advanced users while maintaining the simplicity and safety that makes HNC accessible to all users. This release focuses on two key areas:

1. **Expert Overrides System** - Manual configuration capabilities with comprehensive safety guardrails
2. **Enhanced CI Pipeline** - Optional integration testing that doesn't disrupt core development workflows

## Key Principles

### Safety First
- Impossible configurations are blocked by the rule engine
- All overrides are clearly marked and easily reversible
- Comprehensive validation prevents deployment of invalid configurations

### Non-Disruptive Enhancement
- All existing workflows continue unchanged
- New features are purely additive
- No breaking changes to existing APIs or file formats

### Expert-Friendly Design
- Power users gain flexibility when needed
- Clear understanding of override consequences
- Professional-grade tooling for complex scenarios

## Expert Overrides System

### Core Capabilities

**Field Provenance Tracking**
Every computed value now includes its origin:
- `auto`: Calculated by HNC's algorithms
- `user`: Manually overridden by the user
- `import`: Loaded from external configuration

**Comprehensive Rule Engine**
Three levels of feedback ensure safe configurations:
- **Errors** ❌: Block saving (capacity exceeded, invalid ranges)
- **Warnings** ⚠️: Allow saving with notice (uplink distribution, model mismatches)
- **Info** ℹ️: Optimization suggestions (sub-optimal ratios, port utilization)

**Intuitive User Interface**
- Issues panel with color-coded severity levels
- Override indicators on manually modified fields
- One-click reset to automatic calculations
- Hover tooltips showing original auto-calculated values

### Use Cases

**Network Architecture Teams**
- Override switch counts for specific redundancy requirements
- Adjust uplink configurations for custom cabling layouts
- Fine-tune capacity ratios for specialized workloads

**Implementation Teams** 
- Match configurations to physical constraints
- Accommodate existing infrastructure limitations
- Optimize for specific performance requirements

**Operations Teams**
- Document configuration exceptions
- Review and validate manual overrides
- Monitor for changes in requirements over time

### Example Scenarios

**Forcing Higher Redundancy**
```
Scenario: Auto-calculation suggests 2 spines, but site requires 4
Action: Override spine count from 2 → 4
Result: System shows "Port Utilization: Low spine utilization" (Info)
Outcome: Configuration saves successfully with documented override
```

**Custom Uplink Requirements**
```
Scenario: Cabling infrastructure requires 4 uplinks per leaf
Action: Override uplinks per leaf from 2 → 4  
Result: System recalculates spine capacity requirements
Outcome: May need to adjust spine count or select higher-capacity models
```

**Handling Edge Cases**
```
Scenario: Configuration generates MC-LAG warnings with odd leaf count
Options: 
- Accept: Dismiss warning and proceed (allowed)
- Fix: Add one leaf to make count even
- Revert: Reset to auto-calculated values
```

## Enhanced CI Pipeline

### Architecture

**Core Pipeline (Always Runs)**
- TypeScript type checking
- Application build
- Unit tests
- E2E golden path test
- Storybook build and tests
- **Guarantee**: Completes in under 5 minutes with no external dependencies

**Optional Integration Tests**
- GitHub integration (when `GITHUB_TOKEN` + `GIT_REMOTE` exist)
- K8s integration (when `KUBECONFIG` exists or manually triggered)
- **Guarantee**: Never block core development, purely informational

### GitHub Integration Testing

**Validates**:
- Branch creation and management
- Commit operations with authentication
- Automatic cleanup of test branches
- Error handling and graceful degradation

**Safety Features**:
- Never touches main branch
- Uses isolated test branches (`hnc-ci/<run-id>`)
- Automatic resource cleanup
- Respects GitHub API rate limits

### Kubernetes Integration Testing

**Validates**:
- Resource generation from fabric definitions  
- Deployment to test namespaces
- Drift detection and validation
- Resource lifecycle management

**Safety Features**:
- Namespace isolation (`hnc-it-<run-id>`)
- Label-based resource selection
- Read-only by default
- Automatic cleanup after tests

### Configuration

**For Repository Owners**:
```bash
# GitHub Integration
gh secret set GITHUB_TOKEN --body "ghp_your_token"
gh secret set GIT_REMOTE --body "https://github.com/org/test-repo"

# K8s Integration  
kubectl config view --raw > /tmp/kubeconfig
gh secret set KUBECONFIG < /tmp/kubeconfig
```

**For Developers**:
```bash
# Local testing
export FEATURE_GIT="true"
export GITHUB_TOKEN="your_token"
export GIT_REMOTE="https://github.com/user/test-repo"
npm run int:gh

export FEATURE_K8S="true"  
npm run k8s:validate
```

## Technical Implementation

### Expert Overrides Architecture

**Data Layer**:
```typescript
interface FabricSpec {
  spineCount: { value: number; origin: 'auto' | 'user' | 'import' }
  leafCount: { value: number; origin: 'auto' | 'user' | 'import' }
  uplinksPerLeaf: { value: number; origin: 'auto' | 'user' | 'import' }
  // ... other fields with provenance
}
```

**Rule Engine**:
```typescript
interface RuleEvaluation {
  errors: Issue[]     // Must be empty to save
  warnings: Issue[]   // Allow save with notice
  info: Issue[]       // Informational only
}
```

**Integration Points**:
- Post-compute rule evaluation in `app.machine.ts`
- Save button gating based on error count
- UI components for issue display and override indicators

### CI Pipeline Architecture

**Conditional Execution**:
```yaml
# Core tests (always run)
core-tests:
  runs-on: ubuntu-latest
  steps: [typecheck, build, test, e2e, storybook]

# Optional GitHub integration
integration-github:
  if: ${{ secrets.GITHUB_TOKEN && vars.GIT_REMOTE }}
  needs: core-tests
  
# Optional K8s integration  
integration-k8s:
  if: ${{ secrets.KUBECONFIG || manual_trigger }}
  needs: core-tests
```

**Resource Isolation**:
- Test branches: `hnc-ci/<run-id>`
- Test namespaces: `hnc-it-<run-id>`
- Unique labels: `hncRunId=<run-id>`

## Migration Path

### From v0.4.0 to v0.4.1

**Automatic Compatibility**:
- Existing configurations work without changes
- All values initially marked as `auto` provenance
- No file format changes required
- Zero disruption to existing workflows

**Gradual Adoption**:
- Expert Overrides available when needed
- Integration tests activate when credentials available
- No forced migration or configuration changes
- Existing CI pipelines continue working

### Best Practices for Adoption

**For Teams New to Expert Overrides**:
1. Start with automatic calculations
2. Document rationale for any overrides
3. Review warnings carefully before proceeding
4. Test configurations incrementally

**For Teams Adopting Integration Testing**:
1. Set up test repositories and clusters
2. Configure secrets gradually (GitHub first, then K8s)
3. Monitor integration test results for insights
4. Use integration failures as early warning system

## Quality Assurance

### Testing Strategy

**Expert Overrides**:
- Unit tests for all rule categories
- Comprehensive Storybook stories for UI components
- Integration tests for rule engine evaluation
- E2E tests for complete override workflows

**CI Pipeline**:
- Local testing of all CI modifications
- Validation of conditional execution logic
- Integration with actual GitHub and K8s environments
- Performance testing to ensure core pipeline speed

### Documentation Standards

**Expert Overrides**:
- Complete user guide with examples
- API reference for programmatic usage
- Troubleshooting guide for common issues
- Migration guide from v0.4.0

**Integration Testing**:
- Setup instructions for all environments
- Troubleshooting guide for common failures
- Best practices for credential management
- Performance and scaling considerations

## Roadmap Integration

### Near-term (v0.4.2)
- Enhanced rule customization for site-specific requirements
- Bulk override operations for similar configurations
- Advanced visualization of override impacts
- Integration with external constraint systems

### Medium-term (v0.5.x)
- Advanced GitOps workflows and drift detection
- Multi-cluster testing and federation scenarios  
- Property-based testing for allocator invariants
- Cross-browser compatibility validation

### Long-term (v1.0+)
- Performance and scalability testing at enterprise scale
- AI-assisted configuration optimization
- Advanced analytics and reporting
- Enterprise integration patterns

## Support Resources

### Documentation
- [Expert Overrides Guide](expert-overrides-guide.md) - Complete usage documentation
- [Integration Testing Guide](integration-testing-guide.md) - Setup and troubleshooting
- [Integration Roadmap](integrations-roadmap.md) - Future development plans

### Getting Help
- GitHub Issues for bug reports and feature requests
- Documentation feedback and improvement suggestions
- Community discussion of best practices and use cases

### Contributing
- Pull requests welcome for documentation improvements
- Feature suggestions through GitHub Issues
- Testing feedback from real-world deployments
- Community sharing of configuration patterns

---

HNC v0.4.1 represents a significant evolution in network configuration tooling, providing expert-level capabilities while maintaining the simplicity and safety that make HNC accessible to teams of all skill levels.